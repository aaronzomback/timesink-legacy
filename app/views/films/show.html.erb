<%= render "shared/ticker" %>


<section data-barba="container">




<div class="back-to-films">
  <%= link_to films_path do %>
  <span><%= image_tag "BackArrow1.svg" %> </span><h3 class="back-to-gallery">Back to the sink</h3>
  <% end %>
</div>



<section class="film-show-grid">

    <div class="film-show-img" onclick="toggle();">
  <%= image_tag @film.cover.show.url %>
  </div>

  <div class="film-show-info">
    <span><% if @film.is_top_pick %>
     <%= image_tag "is_featured.svg", :class => "top-pick-show" %>
   <% end %></span>

  <span class="liking-target">
       <%= link_to like_film_path(@film), class: "upvoted {liked_or_not}", method: :put, remote: :true do %>
       <%= image_tag "Polygon2.svg", :class => "polygon" %>
        <% end %>
        <span class="like_count">
          <%= @film.get_likes.size %>
        </span>
  </span>


    <span class="views">
    <%= image_tag "view.svg", :class => "eyeball" %>
      <span class="impressions"><%= @film.impressionist_count(:filter=>:ip_address) %></span>
    <span class="impressions"></span>
    </span>




    <div class="">
      <h2 class="film-title"><%= @film.title %></h2>
      <h6 class="film-author"><%= @film.author %></h6> <span><%= @film.description %></span>
      <p class="film-description"><%= @film.description_body %></p>
    </div>
    <div class="play-button" onclick="toggle();">
      <span> Play </span> <%= image_tag "play.svg", :class => "play-symbol" %>
    </div>
    <div class="preview-button" onclick="toggleTrailer();">
      Trailer
    </div>
    <%= link_to @film.artist_website, :target => '_blank' do  %>
    <div class="cafe-talk-button">
      View artist
    </div>
    <% end %>






  </div>

</section>
</section>

<section class="cafe">
  <!-- cafe reviews section included below film page here -->

  <section>
    <div class="cafe-banner-title">


    <span>
    <span class="film-title-cafe"><h2 class="film-cafe"><%= @film.title %> caf√© </h2></span>
     <span><%= image_tag "coffee.svg", :class => "coffee-cafe" %></span>
    </span>



    <span>
    <%= link_to new_film_review_path(@film) do %>
    <div class="write-review-button">
      Write a review
    </div>
    <% end %>
    </span>

    </div>

    <% if @film.reviews.present? %>

    <% @film.reviews.order(cached_votes_up: :desc, created_at: :desc).each do |review| %>


      <div class="review">
          <%= link_to film_review_path(@film, review) do %>
        <p><%= review.title %> </p>
        <% end %>

    <div class="">
      <% if review.comments.present? %>
      <p class="review-comment-count"><%= pluralize review.comments.count, "Comment" %></p>
      <% else %>
      <p class="review-comment-count">no comments yet</p>
      <% end %>
    </div>




          <p class="posted">

              <% if review.user.avatar.small.url.present? %>
            <span> <%= image_tag review.user.avatar.small.url, :class => "avatar" %> </span>
            <% end %>
            <span><%= link_to review.user.username, user_path(review.user) %> <%= time_ago_in_words(review.created_at) %> ago </span>
              </p>

        </div>

        <div class="review-index-like">
        <%= link_to like_review_path(review), class: "upvoted {liked_or_not}", method: :put, remote: :true do %>
        <span class="like-image-tag">
       <%= image_tag "Polygon2.svg", :class => "upvote-shape" %>
         <% end %>
         </span>
         <span id="js3-<%= review.id %>">
           <%= review.get_likes.size %>
         </span>

           </div>

          <% end %>

        <% else %>

        <h4>No discussion yet...</h4>

        <% end %>
  </section>
</section>


              <div class="popupfilm" id="filmPopUp">
                <span class="">
                  <video-js controls autoplay preload data-setup='{"liveui": true}' class="vjs-big-play-centered" width=960 height=540>
                    <source src="<%= @film.video_url.to_s %>" >
                  </video-js>
                  <span class="close" onclick="toggle();"><%= image_tag "EXIT.svg" %></span>
                </span>
              </div>

              <div class="popuptrailer" id="popuptrailer">
                <span>
                  <video-js controls autoplay preload data-setup='{"liveui": true}' class="vjs-big-play-centered" width=960 height=540>
                  <source src="<%= @film.trailer_url.to_s %>" >
                  </video-js>
              <span class="close" onclick="toggleTrailer();"><%= image_tag "EXIT.svg" %></span>
                </span>
            </div>



                <script type="text/javascript">
                  function toggle() {
                  var popupfilm= document.querySelector(".popupfilm")
                  popupfilm.classList.toggle("active")
                }
              </script>

             <script type="text/javascript">
               function toggleTrailer() {
               var trailer= document.querySelector(".popuptrailer")
               trailer.classList.toggle("active")
             }
              </script>


              <script>
                $(function(){
  var $refreshButton = $('#refresh');
  var $results = $('#css_result');

  function refresh(){
    var css = $('style.cp-pen-styles').text();
    $results.html(css);
  }

  refresh();
  $refreshButton.click(refresh);

  // Select all the contents when clicked
  $results.click(function(){
    $(this).select();
  });
});

              </script>
